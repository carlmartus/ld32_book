function esInitGl(c,b){var a=document.getElementById(c);var f=null;try{f=a.getContext("webgl",b)}catch(d){}if(f==null){try{f=a.getContext("experimental-webgl",b)}catch(d){}}return f}function esInitSw(b){var a=document.getElementById(b);return a.getContext("2d")}function esNextFrame(c){var d=Date.now();var a;if(window&&window.requestAnimationFrame){requestAnimationFrame=window.requestAnimationFrame}else{requestAnimationFrame=function(e){window.setTimeout(e,1000/60)}}function b(){var e=Date.now();if(!c((e-d)*0.001)){requestAnimationFrame(b)}d=e}requestAnimationFrame(b)}var ES_VERTEX=1;var ES_FRAGMENT=2;function esProgram(a){this.gl=a;this.program=a.createProgram()}function compileShader(d,c,a){if(a==ES_VERTEX){a=d.VERTEX_SHADER}else{a=d.FRAGMENT_SHADER}var b=d.createShader(a);d.shaderSource(b,c);d.compileShader(b);if(!d.getShaderParameter(b,d.COMPILE_STATUS)){alert(d.getShaderInfoLog(b))}return b}esProgram.prototype.bindAttribute=function(b,a){this.gl.bindAttribLocation(this.program,b,a)};esProgram.prototype.addShaderId=function(a,b){this.addShaderText(document.getElementById(a).text,b)};esProgram.prototype.addShaderText=function(b,a){this.gl.attachShader(this.program,compileShader(this.gl,b,a))};esProgram.prototype.getUniform=function(a){return this.gl.getUniformLocation(this.program,a)};esProgram.prototype.link=function(){this.gl.linkProgram(this.program)};esProgram.prototype.use=function(){this.gl.useProgram(this.program)};var ES_LOAD_IMAGE=1;var ES_LOAD_AUDIO=2;var ES_LOAD_TEXTURE=3;var GLLOD_BG=16;var GLLOD_FG=12;function esLoad(){this.list=[]}esLoad.prototype.loadImage=function(a){var b=new Image();this.list.push([b,a,ES_LOAD_IMAGE]);return b};esLoad.prototype.loadTexture=function(e,b,d,c){var a=e.createTexture();this.list.push([a,b,ES_LOAD_TEXTURE]);e.bindTexture(e.TEXTURE_2D,a);e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,d);e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,d);return a};esLoad.prototype.loadAudio=function(a){var b=new Audio();this.list.push([b,a,ES_LOAD_TEXTURE]);return b};function renderGlLoadingScreen(g,e,d){var f=g.getParameter(g.VIEWPORT);var a=f[0];var i=f[1];var b=f[2];var c=f[3];g.clearColor(0,0,0,1);g.clear(g.COLOR_BUFFER_BIT);g.enable(g.SCISSOR_TEST);g.scissor(a+GLLOD_BG,i+c/2-GLLOD_BG,b-2*GLLOD_BG,GLLOD_BG*2);g.clearColor(0.5,0.5,0.5,1);g.clear(g.COLOR_BUFFER_BIT);g.scissor(a+(GLLOD_BG+(GLLOD_BG-GLLOD_FG)),i+c/2-GLLOD_FG,(e/d)*(b-2*(GLLOD_BG+(GLLOD_BG-GLLOD_FG))),GLLOD_FG*2);g.clearColor(1,1,1,1);g.clear(g.COLOR_BUFFER_BIT);g.disable(g.SCISSOR_TEST);g.viewport(a,i,b,c)}esLoad.prototype.downloadWithGlScreen=function(a,b){renderGlLoadingScreen(a,0,1);return this.download(b,function(d,c){renderGlLoadingScreen(a,d,c)},a)};esLoad.prototype.download=function(m,c,j){var b=this.list.length;var e=b;for(var h=0;h<this.list.length;h++){var l=this.list[h];var g=l[0];var a=l[1];var k=l[2];var d=(function(n,i){return function(){e--;if(c){c(b-e,b)}if(e==0){m()}}})(g,a);switch(k){default:case ES_LOAD_IMAGE:g.onload=d;g.src=a;break;case ES_LOAD_AUDIO:g.addEventListener("canplaythrough",d,false);g.src=a;break;case ES_LOAD_TEXTURE:var f=new Image();f.onload=function(n,i){j.bindTexture(j.TEXTURE_2D,g);j.texImage2D(j.TEXTURE_2D,0,j.RGBA,j.RGBA,j.UNSIGNED_BYTE,f);d(n,i)};f.src=a;break}}};function esFullFrame(b,d){var a=document.getElementById(b);a.style="padding: 0px; margin: 0px; position: absolute; left: 0px; top: 0px;";var c=function(){var e=window.innerWidth;var f=window.innerHeight;a.width=e;a.height=f;d(e,f)};window.addEventListener("resize",c,false);c()}function esVec3_create(){return new Float32Array([0,0,0])}function esVec3_parse(a,c,b){return new Float32Array([a,c,b])}function esVec3_add(b,a,c){b[0]=a[0]+c[0];b[1]=a[1]+c[1];b[2]=a[2]+c[2]}function esVec3_sub(b,a,c){b[0]=a[0]-c[0];b[1]=a[1]-c[1];b[2]=a[2]-c[2]}function esVec3_mulk(c,b,a){c[0]=a*b[0];c[1]=a*b[1];c[2]=a*b[2]}function esVec3_length(a){return Math.sqrt(a[0]*a[0]+a[1]*a[1]+a[2]*a[2])}function esVec3_dot(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]}function esVec3_isZero(a){return a[0]==0&&a[1]==0&&a[2]==0}function esVec3_cross(b,a,c){b[0]=a[1]*c[2]-a[2]*c[1];b[1]=a[2]*c[0]-a[0]*c[2];b[2]=a[0]*c[1]-a[1]*c[0]}function esVec3_normalize(c,b){var a=1/esVec3_length(b);c[0]=a*b[0];c[1]=a*b[1];c[2]=a*b[2]}function esMat4_create(){return new Float32Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0])}function esMat4_identity(a){a[0]=1;a[1]=a[2]=a[3]=0;a[5]=1;a[4]=a[6]=a[7]=0;a[10]=1;a[8]=a[9]=a[11]=0;a[15]=1;a[12]=a[13]=a[14]=0}function esMat4_mul(b,c,a){b[0]=a[0]*c[0]+a[1]*c[4]+a[2]*c[8]+a[3]*c[12];b[1]=a[0]*c[1]+a[1]*c[5]+a[2]*c[9]+a[3]*c[13];b[2]=a[0]*c[2]+a[1]*c[6]+a[2]*c[10]+a[3]*c[14];b[3]=a[0]*c[3]+a[1]*c[7]+a[2]*c[11]+a[3]*c[15];b[4]=a[4]*c[0]+a[5]*c[4]+a[6]*c[8]+a[7]*c[12];b[5]=a[4]*c[1]+a[5]*c[5]+a[6]*c[9]+a[7]*c[13];b[6]=a[4]*c[2]+a[5]*c[6]+a[6]*c[10]+a[7]*c[14];b[7]=a[4]*c[3]+a[5]*c[7]+a[6]*c[11]+a[7]*c[15];b[8]=a[8]*c[0]+a[9]*c[4]+a[10]*c[8]+a[11]*c[12];b[9]=a[8]*c[1]+a[9]*c[5]+a[10]*c[9]+a[11]*c[13];b[10]=a[8]*c[2]+a[9]*c[6]+a[10]*c[10]+a[11]*c[14];b[11]=a[8]*c[3]+a[9]*c[7]+a[10]*c[11]+a[11]*c[15];b[12]=a[12]*c[0]+a[13]*c[4]+a[14]*c[8]+a[15]*c[12];b[13]=a[12]*c[1]+a[13]*c[5]+a[14]*c[9]+a[15]*c[13];b[14]=a[12]*c[2]+a[13]*c[6]+a[14]*c[10]+a[15]*c[14];b[15]=a[12]*c[3]+a[13]*c[7]+a[14]*c[11]+a[15]*c[15]}function esMat4_ortho(b,c,e,a,d){b[1]=b[2]=b[3]=b[4]=b[6]=b[7]=b[8]=b[9]=0;b[0]=2/(a-c);b[5]=2/(d-e);b[10]=1;b[15]=1;b[12]=-(a+c)/(a-c);b[13]=-(d+e)/(d-e);b[14]=0}function esMat4_lookAt(c,f,b,e){var d=esVec3_create();esVec3_sub(d,b,f);var i=esVec3_create();esVec3_normalize(i,d);var a=esVec3_create();esVec3_cross(a,e,i);var g=esVec3_create();esVec3_normalize(g,a);var h=esVec3_create();esVec3_cross(h,i,g);var k=esMat4_create();esMat4_identity(k);k[0]=g[0];k[4]=g[1];k[8]=g[2];k[1]=h[0];k[5]=h[1];k[9]=h[2];k[2]=-i[0];k[6]=-i[1];k[10]=-i[2];var j=esMat4_create();esMat4_identity(j);j[12]=-f[0];j[13]=-f[1];j[14]=-f[2];esMat4_mul(c,k,j)}function esMat4_perspective(c,d,g,f,e){var j=f*Math.tan(d*0.5);var b=-j;var i=j;var a=-j/g;var h=j/g;c[0]=2*f/(i-b);c[1]=0;c[2]=0;c[3]=0;c[4]=0;c[5]=2*f/(h-a);c[6]=0;c[7]=0;c[8]=(i+b)/(i-b);c[9]=(h+a)/(h-a);c[10]=-(e+f)/(e-f);c[11]=-1;c[12]=0;c[13]=0;c[14]=-(2*e*f)/(e-f);c[15]=0}function esMat4_camera(b,c,h,g,e,f,a,d){var j=esMat4_create();esMat4_perspective(j,c,h,g,e);var i=esMat4_create();esMat4_lookAt(i,f,a,d);esMat4_mul(b,j,i)};